<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>教师首页</title>
  <link rel="stylesheet" href="../font_index/iconfont.css">
  <link rel="shortcut icon" href="./image/favicon.ico" />
  <script src="../js/jquery.min.js"></script>
  <link rel="stylesheet" href="../css/teacher_index.css">
  <link rel="stylesheet" href="../css/calendar.css">
  <script src="../js/jquery-ui-datepicker.min.js"></script>
  <link rel="stylesheet" href="../css/student_index.css">
  <link rel="stylesheet" href="../css/dropzone.css">
  <link rel="stylesheet" href="../css/basic.css">
  <script src="../js/dropzone.min.js"></script>
</head>
<body>
<header>
  <div class="header">
    <div class="wrap">
      <span><i class="iconfont icon-ts-tubiao_linux"></i></span>
      <h3>Linux在线学习平台</h3>
    </div>
  </div>
</header>
<div id="over_hide">
  <div class="left_list clearfloat">
    <h3 id="index_content">教师管理菜单</h3>
    <a class="title">资源管理&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="iconfont icon-youjiantou"></i></a>
    <div class="option_list">
      <a class="option" id="file_check"><i class="iconfont icon-chakan"></i>&nbsp;&nbsp;&nbsp;&nbsp;资源查看 </a>
      <a class="option" id="file_up"><i class="iconfont icon-shangchuan"></i>&nbsp;&nbsp;&nbsp;&nbsp;资源上传</a>
    </div>
    <ul>
      <li></li>
    </ul>
    <a class="title">通知管理&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="iconfont icon-youjiantou"></i></a>
    <div class="option_list">
      <a class="option" id="msg_check"><i class="iconfont icon-tongzhi"></i>&nbsp;&nbsp;&nbsp;&nbsp;通知查看 </a>
      <a class="option" id="msg_up"><i class="iconfont icon-shangchuan"></i>&nbsp;&nbsp;&nbsp;&nbsp;通知发布 </a>
    </div>
    <a class="title">试卷管理&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="iconfont icon-youjiantou"></i></a>
    <div class="option_list">
      <a class="option" id="paper_check"><i class="iconfont icon-shijuan"></i>&nbsp;&nbsp;&nbsp;&nbsp;题库修改 </a>
      <a class="option" id="paper_point"><i class="iconfont icon-tianjiashijuan-"></i>&nbsp;&nbsp;&nbsp;&nbsp;试卷批改 </a>
      <a class="option" id="paper_publish"><i class="iconfont icon-shangchuan"></i>&nbsp;&nbsp;&nbsp;&nbsp;发布试卷 </a>
    </div>
  </div>
  <div class="index_content content clearfloat">
    <h3>欢迎&nbsp;&nbsp;{{data.name}}&nbsp;&nbsp;老师访问Linux在线学习管理平台</h3>
    <div class="index_show clearfloat">
      <div class="tap">
        <p>快捷入口：</p>
        <ul class="fast_list">
          <li id="msg_check_fast">通知查看</li>
          <li id="msg_up_fast">通知发布</li>
          <li id="paper_publish_fast">发布试卷</li>
          <li id="file_up_fast">资源上传</li>
          <li id="paper_point_fast">批改试卷</li>
          <li id="paper_check_fast">题库修改</li>
        </ul>
      </div>
      <div id="calendar"></div>
    </div>

  </div>
  <div class="file_check_content content">
    <div class="download_box">
      <div class="file_row clearfloat">
        <ul class="file_list clearfloat">
          <li class="file_list_th clearfloat">
            <div class="col">文件</div>
            <div class="col">大小</div>
            <div class="col">修改时间</div>
            <div class="col">创建时间</div>
          </li>
        </ul>
      </div>
    </div>
  </div>
  </div>
  <div class="file_up_content content">
    <form action="http://127.0.0.1:8080/upload" class="dropzone" id="dropz"></form>
  </div>
  <div class="msg_check_content content">
    <div class="message clearfloat" style="display: block">
      <div class="wrap clearfloat">
        <div class="message_box clearfloat" id="mes">
          <ul class="message_list clearfloat">
            <li class="message_row clearfloat" >
              <div>
                <h4><a href="">第一周作业</a></h4>
                <p>发布时间：2020-03-28 15:51:53</p>
                <p>发送作者：Wang</p>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="msg_up_content content">
    <div class="msg_list">
      <form action="http://127.0.0.1:8080/msg_add" method="post" enctype="multipart/form-data" id="msg_form">
        <div class="title_input">
          <span>标题：</span>
          <input type="text" id="msg_title_text" name="msg_title">
          <input id="teacher_hide" type="text" name="teacher_name" value="{{data.name}}">
        </div>
        <div class="content_input">
          <span>内容：</span>
          <br>
          <textarea name="msg_content" id="content_textarea" cols="80" rows="12"></textarea>
        </div>
        <button id="msg_submit">
          提交
        </button>
      </form>
    </div>
  </div>
  <div class="paper_check_content content">
    <h2>题库修改</h2>
  </div>
  <div class="paper_point_content content">
    <h2>试卷批改</h2>
  </div>
  <div class="paper_publish_content content">
    <h2>发布试卷</h2>
  </div>

</body>
<script>
  $('#msg_submit').click(function (e) {
    e.preventDefault();
    let title = $('#msg_title_text').val();
    let content = $('#content_textarea').val();
    if (!title||!content){
      alert('标题或内容输入为空，请重新输入！');
    }else {
      $.ajax({
        type: 'POST',
        url : 'http://127.0.0.1:8080/msg_add',
        data: $('#msg_form').serialize(),
        success: function (data) {
          if (data === 'yes'){
            $('#msg_title_text').val('');
            $('#content_textarea').val('');
            $('#msg_check').click();
            alert('通知添加成功');
          }
        }
      })
    }

  });
</script>
<script>
  $('#calendar').datepicker({
    inline: true,
    firstDay: 1,
    showOtherMonths: true,
    dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
  });
  let page = '.index_content';
  $('.left_list .title').click(function () {
      $(this).next().slideToggle();
    if ($(this).children('.iconfont').hasClass('icon-youjiantou')){
      $(this).children('.iconfont').removeClass('icon-youjiantou').addClass('icon-jiantou8');
    }else {
      $(this).children('.iconfont').removeClass('icon-jiantou8').addClass('icon-youjiantou');
    }
  });
  $('#file_check,#file_dir_back').live('click',function () {
    new Promise(resolve => {
      $(page).fadeOut(350);
      setTimeout(function () {
        resolve();
      },400);
    }).then(()=>{
      page = '.file_check_content';
      $(page).fadeIn(350);
    }).then(()=>{
      $.get('http://127.0.0.1:8080/file',function (file_data) {
        $('.download_box .file_list').empty();
        $('.download_box .file_list').append('<li class="file_list_th clearfloat"><div class="col">文件</div><div class="col">大小</div><div class="col">修改时间</div><div class="col">创建时间</div></li>');
        let file_arr = JSON.parse(file_data);
        for (let i=0;i<file_arr.length;i++){
          if (file_arr[i].size != '-'){
            $('.download_box .file_list').append(`<li class="file_list_item clearfloat"><div class="file_color"> <a href="/download/${file_arr[i].name}" download="${file_arr[i].name}">${file_arr[i].name}</a></div><div>${file_arr[i].size}</div><div>${file_arr[i].mtime}</div><div>${file_arr[i].ctime}</div></li>`);
          }else {
            $('.download_box .file_list').append(`<li class="file_list_item clearfloat"><div class="file_color file_dir">${file_arr[i].name}</div><div>${file_arr[i].size}</div><div>${file_arr[i].mtime}</div><div>${file_arr[i].ctime}</div></li>`);
          }
        }
        $('.file_dir').click(function () {
          var dir = this.innerHTML;
          $.post('http://127.0.0.1:8080/file',this.innerHTML,function (file_data) {
            $('.download_box .file_list').empty();
            $('.download_box .file_list').append('<li class="file_list_th clearfloat"><div class="col">文件</div><div class="col">大小</div><div class="col">修改时间</div><div class="col">创建时间</div></li>');
            $('.download_box .file_list').append(`<li class="file_list_item clearfloat"><div><a id="file_dir_back" style="color: black;text-decoration: none" href="#">返回</a></div></li>`);
            var file_arr = JSON.parse(file_data);
            for (let i=0;i<file_arr.length;i++){
              if (file_arr[i].size != '-'){
                $('.download_box .file_list').append(`<li class="file_list_item clearfloat"><div class="file_color"> <a href="/download/${dir}/${file_arr[i].name}" download="${file_arr[i].name}">${file_arr[i].name}</a></div><div>${file_arr[i].size}</div><div>${file_arr[i].mtime}</div><div>${file_arr[i].ctime}</div></li>`);
              }
            }
          })
        });
      });
    })
  });
  $('#file_up,#file_up_fast').click(function () {
    new Promise(resolve => {
      $(page).fadeOut(350);
      setTimeout(function () {
        resolve();
      },400);
    }).then(()=>{
      page = '.file_up_content';
      $(page).fadeIn(350);
    })
  });
  $('#msg_check,#msg_check_fast,#back').live('click',function () {
    new Promise(resolve => {
      $(page).fadeOut(350);
      setTimeout(function () {
        resolve();
      },400);
    }).then(()=>{
      page = '.msg_check_content';
      $(page).fadeIn(350);
    }).then(()=>{
      $.get('http://127.0.0.1:8080/message',function (message_data) {
        let message_json = JSON.parse(message_data);
        // $('.message_list').fadeOut();
        $('.message_list').empty();
        for (let i=0;i<message_json.length;i++){
          $('.message_list').append(`<li class="message_row clearfloat"><div><h4><a>${message_json[i].title}&nbsp;&nbsp;&nbsp;</a></h4><p>发送时间：${message_json[i].add_date}</p><p>发送作者：${message_json[i].teacher_name}</p><p class="hide">内容：${message_json[i].content}</p><div class="hide" id="back">返回</div></div></li>`);
        }
      });
    });
  });
  $('.message_row h4').live('click',function () {
    $('.message_row h4').parent().css('display','none');
    $(this).parent().css('display','block');
    // $(this).parent().slideDown();
    //  let t2 = $(this);
    //  let t = $(this).parent()[0];
    // $('.message_row h4').parent().each(function () {
    //     if (this != t){
    //         $(this).fadeOut(350);
    //     }else {
    //         setTimeout(function () {
    //             console.log(t);
    //             $(t).css({
    //                 'width':'530px',
    //                 'height':'300px',
    //                 'margin-left':'100px'
    //             });
    //             t2.nextAll().removeClass('hide');
    //         },400);
    //
    //     }
    // });
    $(this).parent().css({
      'width':'530px',
      'height':'300px',
      'margin-left':'100px',
      'margin-top':'50px'
    });

    $(this).nextAll().removeClass('hide');
  })
  $('#msg_up,#msg_up_fast').click(function () {
    new Promise(resolve => {
      $(page).fadeOut(350);
      setTimeout(function () {
        resolve();
      },400);
    }).then(()=>{
      page = '.msg_up_content';
      $(page).fadeIn(350);
    }).then(()=>{

    })
  });
  $('#paper_check,#paper_check_fast').click(function () {
    new Promise(resolve => {
      $(page).fadeOut(350);
      setTimeout(function () {
        resolve();
      },400);
    }).then(()=>{
      page = '.paper_check_content';
      $(page).fadeIn(350);
    })
  });
  $('#paper_point,#paper_point_fast').click(function () {
    new Promise(resolve => {
      $(page).fadeOut(350);
      setTimeout(function () {
        resolve();
      },400);
    }).then(()=>{
      page = '.paper_point_content';
      $(page).fadeIn(350);
    })
  });
  $('#paper_publish,#paper_publish_fast').click(function () {
    new Promise(resolve => {
      $(page).fadeOut(350);
      setTimeout(function () {
        resolve();
      },400);
    }).then(()=>{
      page = '.paper_publish_content';
      $(page).fadeIn(350);
    })
  });
  $('#index_content').click(function () {
    new Promise(resolve => {
      $(page).fadeOut(350);
      setTimeout(function () {
        resolve();
      },400);
    }).then(()=>{
      page = '.index_content';
      $(page).fadeIn(350);
    })
  });

</script>
<script>
  Dropzone.options.dropz = {
    paramName: "file", // The name that will be used to transfer the file
    dictDefaultMessage: '拖动文件至此或者点击上传',
    dictResponseError: '文件上传失败!',
    dictFallbackMessage: "浏览器不受支持",
    dictRemoveLinks: "删除",
    dictCancelUpload: "取消",
  };
</script>
</html>
